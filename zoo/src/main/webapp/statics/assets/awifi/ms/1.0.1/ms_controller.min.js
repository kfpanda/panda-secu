var BuyController=EasyController.extend({selector:{},request:function(){this._data={}},addEventListener:function(){$("#addPic").on("tap",function(){var num=$("#num").val()||"0";num++,num>0&&$("#cutPic").attr("src","img/buy/cut.png"),$("#num").val(num)}),$("#cutPic").on("tap",function(){var num=$("#num").val()||"0";if(num--,0==num)$("#cutPic").attr("src","img/buy/cutnot.png");else if(0>num)return;$("#num").val(num)}),$("#buy").on("tap",function(){var num=$("#num").val()||"0",unit=$("#unit").val()||"0",totalPay=unit*num,account="15012345678",undertime="<span>2015-12-1</span>至<span>12-6</span>";$("#totalPay").text(totalPay),$("#account").html(account),$("#undertime").html(undertime),$(".mask").show(),$(".modal").show()}),$("#cancel").on("tap",function(){$(".modal").hide(),$(".mask").hide()}),$("#surePay").on("tap",function(){alert("调支付接口")})}}),IndexController=EasyController.extend({selector:{},request:function(){this._data={mngPower:1}},addEventListener:function(){$("#buy").on("tap",function(){mvc.href("#/buy")})}}),ConfigController=EasyController.extend({selector:{},request:function(){this._data={}},addActiveRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},delActiveRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},saveConfigRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},addEventListener:function(){function limitText(field,max,num){var v=field.val()||"";if(v.length>max){var n=v.substr(0,max);field.val(n)}else if(num){var l=max-v.length;num.html(l)}}var that=this,id=this.params.id;$("#addActive").on("tap",function(){var activeTitle=$("#activeTitle").val()||"",activeMsg=$("#activeMsg").val()||"";Protocol.request("mng.addActive",{parameter:{id:id,activeTitle:activeTitle,activeMsg:activeMsg},success:that.addActiveRequest})}),$("a[name='delActive']").on("tap",function(){var activeId=$(this).parent().find("input").val()||"";Protocol.request("mng.delActive",{parameter:{activeId:activeId},success:that.delActiveRequest})}),$("#saveConfig").on("tap",function(){$("#introduce").val();Protocol.request("mng.saveConfig",{parameter:{},success:that.saveConfigRequest})}),$("#introduce").on("keyup",function(){limitText($(this),50,$("#introLimit"))}),$("#introduce").on("keydown",function(){limitText($(this),50,$("#introLimit"))}),$("#introduce").on("change",function(){limitText($(this),50,$("#introLimit"))}),$("#activeMsg").on("keyup",function(){limitText($(this),50,$("#activeLimit"))}),$("#activeMsg").on("keydown",function(){limitText($(this),50,$("#activeLimit"))}),$("#activeMsg").on("change",function(){limitText($(this),50,$("#activeLimit"))})}}),MngInfoController=EasyController.extend({selector:{},request:function(){this._data={}},mngInfoRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},addEventListener:function(){var that=this;$(".info-avatar-file").on("change",function(){loading.show()}),$("#save").on("tap",function(){var sex,$errorMsg=$(".errorMsg"),imgUrl=$(".info-avatar-img").attr("src")||"/??",nickName=$("input[name='nickName']").val()||"",name=$("input[name='name']").val()||"";sex=$("#female").is(":checked")?2:$("#male").is(":checked")?1:0;var birthday=$("input[type='date']").val()||"";return""==nickName?void $errorMsg.text("请输入昵称"):(loading.show(),void Protocol.request("mng.mngInfo",{parameter:{imgUrl:imgUrl,nickName:nickName,sex:sex,birthday:birthday,name:name},success:that.mngInfoRequest}))}),$(".info-sex").find("input[type=checkbox]").on("change",function(){$(".info-sex").find("input[type=checkbox]").not($(this)).each(function(){$(this).is(":checked")&&$(this).removeAttr("checked")})})}}),StatiscialController=EasyController.extend({selector:{},request:function(){var datas={id:1,name:"ssss"};this._data={data:datas}},statiscialRequest:function(options,result,textStatus,jqXHR){1==result.r&&(this._data={data:result.data}),loading.hide()},userPayDetailRequest:function(options,result,textStatus,jqXHR){1==result.r&&(this._data={data:result.data}),loading.hide()},addEventListener:function(){function getDetail(id,curpage,pagesize){Protocol.request("mng.userPayDetail",{parameter:{id:id,curpage:curpage,pagesize:pagesize},success:that.userPayDetailRequest})}var curpage=1,pagesize=10,that=this,id=123455;getDetail(id,curpage,pagesize),$("#more").on("tap",function(){curpage++,console.log(curpage),getDetail(id,curpage,pagesize)})}}),LoginController=EasyController.extend({selector:{},request:function(){this._data={}},loginRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},addEventListener:function(){var that=this,$username=$("input[name=username]"),$password=$("input[name=password]"),$loginmsg=$(".errorMsg");$("#login").on("tap",function(){function mobileStyle(str){var re=/^1\d{10}$/;return re.test(str)?void 0:!0}function pwdStyle(str){var re=/^[0-9 | A-Z | a-z]{6,20}$/;return re.test(str)?void 0:!0}var username=($(this),$username.val()||""),password=$password.val()||"";return""==username||""==password||mobileStyle(username)||pwdStyle(password)?($loginmsg.text("请输入正确的帐号或密码"),!1):(loading.show(),Protocol.request("user.login",{parameter:{username:username,password:password},success:that.loginRequest}),$username.on("change",function(){$loginmsg.text("")}),void $password.on("change",function(){$loginmsg.text("")}))})}}),RegisterController=EasyController.extend({selector:{},request:function(){this._data={}},registerRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},addEventListener:function(){function mobileStyle(str){var re=/^1\d{10}$/;return re.test(str)?void 0:!0}function pwdStyle(str){var re=/^[0-9 | A-Z | a-z]{6,20}$/;return re.test(str)?void 0:!0}var that=this,cutdownTime=61,$username=$("input[name=username]"),$captcha=$("input[name=captcha]"),$password=$("input[name=password]"),$passwordAgain=$("input[name=password_again]"),$regmsg=$(".errorMsg");$("#registerBtn").on("tap",function(){var username=$username.val()||"",captcha=$captcha.val()||"",password=$password.val()||"",passwordAgain=$passwordAgain.val()||"";return""==username||mobileStyle(username)?($regmsg.text("请输入正确的手机号"),!1):""!=captcha&&/^[0-9]{4}$/.test(captcha)?""==password||pwdStyle(password)?($regmsg.text("请输入正确的密码格式"),!1):""==passwordAgain||password!=passwordAgain?($regmsg.text("两次输入的密码不一致"),!1):(loading.show(),void Protocol.request("user.register",{parameter:{username:username,password:password,captcha:captcha},success:that.registerRequest})):($regmsg.text("请输入正确的验证码"),!1)}),$(".captcha").find("button").on("tap",function(){var self=$(this),username=$username.val()||"";if(""==username||mobileStyle(username))return $regmsg.text("请输入正确的手机号"),!1;self.attr("disabled",!0),self.text("发送中");var time=cutdownTime,sI=setInterval(function(){time-=1,0!==time?self.text(time+"秒后重试"):(window.clearInterval(sI),time=cutdownTime,self.text("重新获取"),self.attr("disabled",!1))},1e3)}),$("#showRule").on("tap",function(){$("#register").hide(),$("#rule").show()}),$("#agreeRule").on("tap",function(){$("#rule").hide(),$("#register").show()})}}),ResetPwdController=EasyController.extend({selector:{},request:function(){this._data={}},resetPwdRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},addEventListener:function(){function mobileStyle(str){var re=/^1\d{10}$/;return re.test(str)?void 0:!0}function pwdStyle(str){var re=/^[0-9 | A-Z | a-z]{6,20}$/;return re.test(str)?void 0:!0}var that=this,cutdownTime=61,$username=$("input[name=username]"),$captcha=$("input[name=captcha]"),$password=$("input[name=password]"),$passwordAgain=$("input[name=password_again]"),$regmsg=$(".errorMsg");$("#submit").on("tap",function(){$regmsg.text("");var username=$username.val()||"",captcha=$captcha.val()||"",password=$password.val()||"",passwordAgain=$passwordAgain.val()||"";return""==username||mobileStyle(username)?($regmsg.text("请输入正确的手机号"),!1):""!=captcha&&/^[0-9]{4}$/.test(captcha)?""==password||pwdStyle(password)?($regmsg.text("请输入正确的密码格式"),!1):""==passwordAgain||password!=passwordAgain?($regmsg.text("两次输入的密码不一致"),!1):(loading.show(),void Protocol.request("user.resetPwd",{parameter:{username:username,password:password,captcha:captcha},success:that.resetPwdRequest})):($regmsg.text("请输入正确的验证码"),!1)}),$(".captcha").find("button").on("tap",function(){$regmsg.text("");var self=$(this),username=$username.val()||"";if(""==username||mobileStyle(username))return $regmsg.text("请输入正确的手机号"),!1;self.attr("disabled",!0),self.text("发送中");var time=cutdownTime,sI=setInterval(function(){time-=1,0!==time?self.text(time+"秒后重试"):(window.clearInterval(sI),time=cutdownTime,self.text("重新获取"),self.attr("disabled",!1))},1e3)})}}),UserCenterController=EasyController.extend({selector:{},request:function(){this.params.id||""},registerRequest:function(options,result,textStatus,jqXHR){1==result.r&&(this._data={}),loading.hide()},payRecordsRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},addEventListener:function(){var curpage=0,pagesize=8,that=this;$("#more").on("tap",function(){curpage++,console.log(curpage);var id=that.params.id||"";Protocol.request("user.payRecords",{parameter:{id:id,curpage:curpage,pagesize:pagesize},success:that.payRecordsRequest})})}}),UserInfoController=EasyController.extend({selector:{},request:function(){this._data={}},userInfoRequest:function(options,result,textStatus,jqXHR){1==result.r,loading.hide()},addEventListener:function(){var that=this;$(".info-avatar-file").on("change",function(){loading.show()}),$("#save").on("tap",function(){var sex,$errorMsg=$(".errorMsg"),imgUrl=$(".info-avatar-img").attr("src")||"/??",nickName=$("input[name='nickName']").val()||"";sex=$("#female").is(":checked")?2:$("#male").is(":checked")?1:0;var birthday=$("input[type='date']").val()||"",address=$("textarea").val()||"";return""==nickName?void $errorMsg.text("请输入昵称"):(loading.show(),void Protocol.request("user.userInfo",{parameter:{imgUrl:imgUrl,nickName:nickName,sex:sex,birthday:birthday,address:address},success:that.userInfoRequest}))}),$(".info-sex").find("input[type=checkbox]").on("change",function(){$(".info-sex").find("input[type=checkbox]").not($(this)).each(function(){$(this).is(":checked")&&$(this).removeAttr("checked")})})}});