app.factory("confMngDao",function($location,$http,pageDao){var dao={};return dao.list=function($scope){var curpage=pageDao.getcurpage(),name=$scope.searchConfName||"",mgid=$scope.menuGroupId||"",pid=$scope.menuProId||"",url="conf/show?name="+name+"&curpage="+curpage+"&mgid="+mgid+"&pid="+pid;$http.get(url).success(function(data,status,headers,config){if(data&&1==data.r){$scope.conflist=data.data;var page=data.page;pageDao.init($scope,page)}})},dao.add=function($scope){var name=$scope.confName||"",pid=$scope.pro.id||"",mgid=$scope.group.id||"",url="conf/add?name="+name+"&pid="+pid+"&mgid="+mgid;$http.post(url).success(function(data,status,headers,config){data&&1==data.r&&$location.path("/confList")})},dao.upd=function($scope){console.log($scope);var id=$scope.conf.id||"",name=$scope.conf.name||"",pid=$scope.pro.id||"",mgid=$scope.group.id||"",url="conf/update?id="+id+"&pid="+pid+"&mgid="+mgid+"&name="+name;$http.post(url).success(function(data,status,headers,config){data&&1==data.r&&$location.path("/confList")})},dao.del=function(id,$scope){console.log(id);var url="conf/del?id="+id;$http.get(url).success(function(data,status,headers,config){data&&1==data.r&&$scope.list()})},dao}),app.factory("groupDao",function($location,$http,pageDao){var dao={};return dao.list=function($scope){var curpage=pageDao.getcurpage(),searchName=$scope.searchName||"",url="/mod/show?curpage="+curpage+"&name="+searchName;$http.get(url).success(function(data,status,headers,config){if(console.log(data),data&&1==data.r){$scope.grouplist=data.data;var page=data.page;pageDao.init($scope,page)}})},dao.del=function(id,$scope){var url="/mod/del?id="+id;$http.get(url).success(function(data,status,headers,config){data&&1==data.r&&$scope.list()})},dao.add=function($scope){var pid=($scope.group.name,$scope.group.desc,$scope.pro.id),url="/mod/add?name="+$scope.group.name+"&desc="+$scope.group.desc+"&pid="+pid;$http.post(url).success(function(data,status,headers,config){data&&1==data.r?$location.path("/groupList"):console.log(data.r)})},dao.upd=function($scope){var url="/mod/update?name="+$scope.group.name+"&desc="+$scope.group.desc+"&id="+$scope.group.id+"&state=1";$http.post(url).success(function(data,status,headers,config){data&&1==data.r&&$location.path("/groupList")})},dao.checkname=function($scope){var name=$scope.group.name,url="mod/auth?name="+name;$http.post(url).success(function(data,status,headers,config){console.log(data),data&&1!=data.r?$scope.checknameresult=!0:$scope.checknameresult=!1})},dao}),app.factory("pageDao",function($http,$compile){var dao={},initcurpage=function($scope,curpage,totalpage){var html="";html+="<ul>",1!=curpage&&(html+='<li class="pre_page">上一页</li>');var maxPreNo=5,hasPreNo=totalpage>8&&curpage>maxPreNo,maxSuffixNo=totalpage-3,hasSuffixNo=totalpage>8&&maxSuffixNo>curpage;if(hasPreNo&&!hasSuffixNo){html+='<li class="page_one">1</li>',html+='<li id="pn-break">…</li>';for(var startIndex=totalpage-6,i=startIndex;totalpage>=i;i++)0>=i||(html+="<li ",curpage==i&&(html+='id="page_selected" '),html+='class="page_one">'+i+"</li>")}else if(hasPreNo&&hasSuffixNo){html+='<li class="page_one">1</li>',html+='<li id="pn-break">…</li>';for(var startIndex=curpage-3,endIndex=curpage+2,i=startIndex;endIndex>=i;i++)0>=i||(html+="<li ",curpage==i&&(html+='id="page_selected" '),html+='class="page_one">'+i+"</li>");html+='<li id="pn-break">…</li>',html+='<li class="page_one">'+totalpage+"</li>"}else if(!hasPreNo&&hasSuffixNo){for(var maxSize=maxPreNo+2,i=1;maxSize>=i;i++)html+="<li ",curpage==i&&(html+='id="page_selected" '),html+='class="page_one">'+i+"</li>";html+='<li id="pn-break">…</li>',html+='<li class="page_one">'+totalpage+"</li>"}else if(!hasPreNo&&!hasSuffixNo)for(var i=1;totalpage>=i;i++)html+="<li ",curpage==i&&(html+='id="page_selected" '),html+='class="page_one">'+i+"</li>";curpage!=totalpage&&curpage!=totalpage&&(html+='<li class="next_page">下一页</li>'),html+="</ul>";var $curpageBar=$(".right_footer_page");$curpageBar.empty().append(html)},initPageNum=function(pagesize){$(".show_page").each(function(){var $this=$(this),num=$this.attr("value");num==pagesize&&$this.attr("id","page_selected")})},bindPageEvent=function($scope){var $curpageBar=$(".right_footer_page");$curpageBar.find(".pre_page").bind("click",function(){var $curcurpage=$curpageBar.find("#page_selected"),$prevcurpage=$curcurpage.prev();$curcurpage.attr("id",""),$prevcurpage.attr("id","page_selected"),$scope.list()}),$curpageBar.find(".page_one").bind("click",function(){$curpageBar.find("#page_selected").attr("id","");var $this=$(this);$this.attr("id","page_selected"),$scope.list()}),$curpageBar.find(".next_page").bind("click",function(){var $curcurpage=$curpageBar.find("#page_selected"),$nextcurpage=$curcurpage.next();$curcurpage.attr("id",""),$nextcurpage.attr("id","page_selected"),$scope.list()});var $pageNumBar=$(".page_num"),$show_page=$pageNumBar.find(".show_page");$show_page.off(),$show_page.on("click",function(){$pageNumBar.find("#page_selected").attr("id","");var $this=$(this);$this.attr("id","page_selected");var paramKey="page.pagesize",paramValue=$this.val(),url="/sysconfig/setvaluebykey?paramKey="+paramKey+"&paramValue="+paramValue;$http.get(url).success(function(data,status,headers,config){return"FAIL"==data.result?void jDialog.alert(data.message):void $scope.list()}).error(function(data,status,headers,config){})})};return dao.getcurpage=function(){var curpage=$('.right_footer_page  li[id="page_selected"]').text();return(null==curpage||void 0==curpage||""==$.trim(curpage))&&(curpage=1),curpage},dao.init=function($scope,data){var curpage=data.curpage,totalpage=data.totalpage,pagesize=data.pagesize,totalcount=data.totalcount;$scope.showPageBar=totalcount>0?!0:!1,initcurpage($scope,curpage,totalpage),initPageNum(pagesize),bindPageEvent($scope)},dao}),app.factory("proMngDao",function($location,$http,pageDao){var dao={};return dao.getlist=function($scope){var curpage=pageDao.getcurpage(),searchCode=$scope.searchCode||"",url="project/show?code="+searchCode+"&curpage="+curpage;$http.get(url).success(function(data,status,headers,config){if(console.log(data),data&&1==data.r){$scope.prolist=data.data;var page=data.page;pageDao.init($scope,page)}})},dao.add=function($scope){var code=$scope.pro.code,name=$scope.pro.name,desc=$scope.pro.desc,url="project/add?code="+code+"&name="+name+"&desc="+desc;$http.post(url).success(function(data,status,headers,config){console.log(data),data&&1==data.r&&$location.path("/proList")})},dao.del=function(id,$scope){var url="project/update?id="+id;$http.get(url).success(function(data,status,headers,config){console.log(data),data&&1==data.r&&$scope.list()})},dao.upd=function($scope){var url="project/update?name="+$scope.pro.name+"&desc="+$scope.pro.desc+"&id="+$scope.pro.id+"&state=1";$http.post(url).success(function(data,status,headers,config){console.log(data),data&&1==data.r&&$location.path("/proList")})},dao.checkcode=function($scope){var code=$scope.pro.code,url="project/auth?code="+code;$http.post(url).success(function(data,status,headers,config){console.log(data),data&&1!=data.r?$scope.checkcoderesult=!0:$scope.checkcoderesult=!1})},dao}),app.factory("showChartDao",function($location,$http,pageDao,$rootScope){var dao={};return dao.getData=function($scope){$scope.statdate=[],$scope.pv=[],$scope.uv=[],$scope.click=[],$scope.staytime=[],$scope.lostnum=[],$scope.scid=[];var curpage=pageDao.getcurpage(),scid=$scope.confid,url="stat/show?scid="+scid+"&curpage="+curpage;$http.get(url).success(function(data,status,headers,config){if(console.log(data),data&&1==data.r){var page=data.page;pageDao.init($scope,page);var data=data.data||[];if(data.length>0){for(var i=0;i<data.length;i++)$scope.statdate[i]=data[i].statdate,$scope.pv[i]=data[i].pv||"0",$scope.uv[i]=data[i].uv||"0",$scope.click[i]=data[i].click||"0",$scope.staytime[i]=data[i].staytime||"0",$scope.lostnum[i]=data[i].lostnum||"0",$scope.scid[i]=data[i].scid||"";$scope.$broadcast("to-child",$scope),console.log($scope)}}})},dao});